flows:
- reader:
    file:
      path: https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat
      delimited:
        fields: AirportID, Name, City, Country, IATA, ICAO, Latitude, Longitude, Altitude, Timezone, DST, Tz, Type, Source
  processor:
    fields:
      Location: in['Longitude']?.concat(',')?.concat(in['Latitude'])
  writers:
  - redis:
      keyspace: airport
      keys: AirportID
  - redis:
      keyspace: airports:country
      keys: Country
      type: set
      set:
        fields: AirportID
  - redis:
      keyspace: airports:geo
      type: geo
      geo:
        latitude: Latitude
        longitude: Longitude
        fields: AirportID
  - redis:
      keyspace: airportIdx
      keys: AirportID
      type: search
      search:
        schema:
        - name: Name
        - name: City
          sortable: true
        - name: Country
          sortable: true
        - name: Location
          type: geo
- reader:
    file:
      path: https://raw.githubusercontent.com/jpatokal/openflights/master/data/airlines.dat
      delimited:
        fields: AirlineID, Name, Alias, IATA, ICAO, Callsign, Country, Active
  writers:
  - redis:
      keyspace: airline
      keys: AirlineID
  - redis:
      keyspace: airlines:country
      keys: Country
      type: set
      set:
        fields: AirlineID
  - redis:
      keyspace: airlineIdx
      keys: AirlineID
      type: search
      search:
        schema:
        - name: Name
        - name: Alias
        - name: IATA
        - name: ICAO
        - name: Callsign
        - name: Country
          sortable: true
        - name: Active
          sortable: true
- reader:
    file:
      path: https://raw.githubusercontent.com/jpatokal/openflights/master/data/routes.dat
      delimited:
        fields: Airline, AirlineID, SourceAirport, SourceAirportID, DestinationAirport, DestinationAirportID, Codeshare, Stops, Equipment
  writers:
  - redis:
      keyspace: route
      keys: Airline, SourceAirport, DestinationAirport
  - redis:
      keyspace: routes:equipment
      keys: Equipment
      type: set
      set:
        fields: Airline, SourceAirport, DestinationAirport
  - redis:
      keyspace: routeIdx
      keys: Airline, SourceAirport, DestinationAirport
      type: search
      search:
        schema:
        - name: Airline
        - name: AirlineID
        - name: SourceAirport
        - name: SourceAirportID
        - name: DestinationAirport
        - name: DestinationAirportID
        - name: Codeshare
        - name: Stops
        - name: Equipment
- reader:
    file:
      path: https://raw.githubusercontent.com/jpatokal/openflights/master/data/planes.dat
      delimited:
        fields: Name, IATA, ICAO
  writers:
  - redis:
      keyspace: plane
      keys: IATA, ICAO