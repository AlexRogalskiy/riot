flows:
  stores:
    reader:
      file:
        path: /Users/jruaux/DocumentsRL/Customers/Gap ICM/InventoryPoC/GapLogInventoryForPOC/DC_Stores.csv
        delimited:
          header: true
    writers:
    - redis:
        keyspace: node
        keys: DC_ID
    - redis:
        keyspace: nodes
        set:
          fields: DC_ID
  stores-geo:
    reader:
      file:
        path: /Users/jruaux/DocumentsRL/Customers/Gap ICM/InventoryPoC/GapLogInventoryForPOC/DC_GEOADDR.csv
        delimited:
          header: true
    processor:
      fields:
        location: "containsKey('LONGITUDE')?LONGITUDE.concat(',').concat(LATITUDE):''"
    writers:
    - redis:
        keyspace: node
        keys: DC_ID
  stores-gen:
    max-item-count: 3568  
    reader:
      generator:
        fields:
          DC_ID: "#sequence.nextMember('nodes')"
          giftwrap: "bool.bool"
          nextday: "bool.bool"
          pobox: "bool.bool"
    writers:
    - redis:
        keyspace: node
        keys: DC_ID
    - redis:
        keyspace: nodeIdx
        keys: DC_ID
        search:
          noSave: true
          schema:
          - name: DC_ID
          - name: GID_MKT_CD
            sortable: true
          - name: DC_CPCY_AMT
            type: numeric
            sortable: true
          - name: DC_TYP_CD
            sortable: true
          - name: STR_DC_MAX_RLSE_ORD_PER_DY
            type: numeric
            sortable: true
          - name: DC_STAT_TYP_CD
            sortable: true
          - name: DC_SUP_OFST_QTY
            type: numeric
            sortable: true
          - name: ROLLUP_INVENTORY
            sortable: true
          - name: GID_DC_RESYNC_GRP
            sortable: true
          - name: DC_DESC
            sortable: true
          - name: GEO_POSITION_ID
          - name: PREFERRED
            sortable: true
          - name: ISDEFAULT
            sortable: true
          - name: DC_INV_AVAL_TO_SELL
            sortable: true
          - name: PARENT_DC_ID
            sortable: true
          - name: ADDR_LN1_TXT
          - name: ADDR_LN2_TXT
          - name: ADDR_LN3_TXT
          - name: CITY_NM
            sortable: true
          - name: CNTY_NM
            sortable: true
          - name: ST_PROV_CD
            sortable: true
          - name: PSTL_CD
            sortable: true
          - name: CTRY_CD
            sortable: true
          - name: PHN_NBR
            sortable: true
          - name: location
            type: geo
          - name: giftwrap
            sortable: true
          - name: nextday
            sortable: true
          - name: pobox
            sortable: true
  stock:
    max-item-count: 35680000
    partitions: 3
    reader:
      type: generator
      generator:
        map: "number.randomDoubleMap(0,0,100,'onhand','hold','reserved','allocated','backordered','excluded')"
        fields:
          node: "#sequence.nextMember('nodes')"        
          sku: "sequence.next('sku',#partition.index*1000,(#partition.index+1)*1000,'%09d')"
          brand: "number.digits(1)"
    processor:
      merge: "#redis.hgetall('node:'.concat(node))"
    writers:
    - redis:
        keyspace: stock
        keys: node,sku
        search:
          schema:
          - name: node
          - name: sku
          - name: brand
            sortable: true
          - name: onhand
            type: numeric
            sortable: true
          - name: hold
            type: numeric
            sortable: true
          - name: reserved
            type: numeric
            sortable: true
          - name: allocated
            type: numeric
            sortable: true
          - name: backordered
            type: numeric
            sortable: true
          - name: excluded
            type: numeric
            sortable: true
          - name: DC_ID
            sortable: true
          - name: GID_MKT_CD
            sortable: true
          - name: DC_CPCY_AMT
            type: numeric
            sortable: true
          - name: DC_TYP_CD
          - name: STR_DC_MAX_RLSE_ORD_PER_DY
            type: numeric
            sortable: true
          - name: DC_STAT_TYP_CD
            sortable: true
          - name: DC_SUP_OFST_QTY
            type: numeric
            sortable: true
          - name: ROLLUP_INVENTORY
            sortable: true
          - name: GID_DC_RESYNC_GRP
            sortable: true
          - name: DC_DESC
            sortable: true
          - name: GEO_POSITION_ID
            sortable: true
          - name: PREFERRED
            sortable: true
          - name: ISDEFAULT
            sortable: true
          - name: DC_INV_AVAL_TO_SELL
            sortable: true
          - name: PARENT_DC_ID
            sortable: true
          - name: ADDR_LN1_TXT
          - name: ADDR_LN2_TXT
          - name: ADDR_LN3_TXT
          - name: CITY_NM
            sortable: true
          - name: CNTY_NM
            sortable: true
          - name: ST_PROV_CD
            sortable: true
          - name: PSTL_CD
            sortable: true
          - name: CTRY_CD
            sortable: true
          - name: PHN_NBR
            sortable: true
          - name: location
            type: geo
          - name: giftwrap
            sortable: true
          - name: nextday
            sortable: true
          - name: pobox
            sortable: true