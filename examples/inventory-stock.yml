concurrent: true
flows:
- max-item-count: 50000000
  max-threads: 4
  chunk-size: 150
  generator:
    fields:
      node: redis.sRandMember('nodes')
      sku: sequence.next('sku',1,500000,'%09d')
      brand: number.digits(1)
      onhand: number.randomNumber(2, false)
      hold: number.randomNumber(2, false)
      reserved: number.randomNumber(2, false)
      allocated: number.randomNumber(2, false)
      backordered: number.randomNumber(2, false)
      excluded: number.randomNumber(2, false)
  processor:
    map: redis.hGetAll('node:'.concat(in['node']))
    fields:
      location: redis.hGet('node:'.concat(in['node']), 'location')
  writers:
  - redis:
      keyspace: stock
      keys: node, sku
  - redis:
      keyspace: skus
      keys: node
      set:
        fields: sku
  - redis:
      keyspace: skus
      set:
        fields: sku
  - redis:
      keyspace: stock
      keys: node, sku
      search:
        index: stockft
        drop: false
        create: true
        add:
          no-save: true
        schema:
        - name: node
        - name: sku
        - name: brand
          sortable: true
        - name: onhand
          type: numeric
          sortable: true
        - name: hold
          type: numeric
          sortable: true
        - name: reserved
          type: numeric
          sortable: true
        - name: allocated
          type: numeric
          sortable: true
        - name: backordered
          type: numeric
          sortable: true
        - name: excluded
          type: numeric
          sortable: true
        - name: DC_ID
        - name: GID_MKT_CD
        - name: DC_CPCY_AMT
          type: numeric
          sortable: true
        - name: DC_TYP_CD
        - name: STR_DC_MAX_RLSE_ORD_PER_DY
          type: numeric
          sortable: true
        - name: DC_STAT_TYP_CD
        - name: DC_SUP_OFST_QTY
          type: numeric
          sortable: true
        - name: ROLLUP_INVENTORY
        - name: GID_DC_RESYNC_GRP
        - name: DC_DESC
        - name: GEO_POSITION_ID
        - name: PREFERRED
        - name: ISDEFAULT
        - name: DC_INV_AVAL_TO_SELL
        - name: PARENT_DC_ID
        - name: ADDR_LN1_TXT
        - name: ADDR_LN2_TXT
        - name: ADDR_LN3_TXT
        - name: CITY_NM
        - name: CNTY_NM
        - name: ST_PROV_CD
        - name: PSTL_CD
        - name: CTRY_CD
        - name: PHN_NBR
        - name: location
          type: geo
- max-item-count: 50000000
  max-threads: 4
  chunk-size: 150
  generator:
    fields:
      node: redis.sRandMember('nodes')
      sku: sequence.next('sku',500000,1000000,'%09d')
      brand: number.digits(1)
      onhand: number.randomNumber(2, false)
      hold: number.randomNumber(2, false)
      reserved: number.randomNumber(2, false)
      allocated: number.randomNumber(2, false)
      backordered: number.randomNumber(2, false)
      excluded: number.randomNumber(2, false)
  processor:
    map: redis.hGetAll('node:'.concat(in['node']))
    fields:
      location: redis.hGet('node:'.concat(in['node']), 'location')
  writers:
  - redis:
      keyspace: stock
      keys: node, sku
  - redis:
      keyspace: skus
      keys: node
      set:
        fields: sku
  - redis:
      keyspace: skus
      set:
        fields: sku
  - redis:
      keyspace: stock
      keys: node, sku
      search:
        index: stockft
        create: true
        drop: false
        add:
          no-save: true
        schema:
        - name: node
        - name: sku
        - name: brand
          sortable: true
        - name: onhand
          type: numeric
          sortable: true
        - name: hold
          type: numeric
          sortable: true
        - name: reserved
          type: numeric
          sortable: true
        - name: allocated
          type: numeric
          sortable: true
        - name: backordered
          type: numeric
          sortable: true
        - name: excluded
          type: numeric
          sortable: true
        - name: DC_ID
        - name: GID_MKT_CD
        - name: DC_CPCY_AMT
          type: numeric
          sortable: true
        - name: DC_TYP_CD
        - name: STR_DC_MAX_RLSE_ORD_PER_DY
          type: numeric
          sortable: true
        - name: DC_STAT_TYP_CD
        - name: DC_SUP_OFST_QTY
          type: numeric
          sortable: true
        - name: ROLLUP_INVENTORY
        - name: GID_DC_RESYNC_GRP
        - name: DC_DESC
        - name: GEO_POSITION_ID
        - name: PREFERRED
        - name: ISDEFAULT
        - name: DC_INV_AVAL_TO_SELL
        - name: PARENT_DC_ID
        - name: ADDR_LN1_TXT
        - name: ADDR_LN2_TXT
        - name: ADDR_LN3_TXT
        - name: CITY_NM
        - name: CNTY_NM
        - name: ST_PROV_CD
        - name: PSTL_CD
        - name: CTRY_CD
        - name: PHN_NBR
        - name: location
          type: geo          