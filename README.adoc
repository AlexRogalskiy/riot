= RIOT
:source-highlighter: highlightjs
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

Redis Input/Output Tool (RIOT) is a data import/export tool for Redis and Redis Modules.

== Inputs
* Databases: any JDBC driver
* Files: delimited (CSV), fixed-width, JSON
* Generator: https://github.com/stympy/faker[Faker], simple

== Outputs
* Databases: any JDBC driver
* Files: delimited (CSV), formatted, JSON

== Installation
Download the https://github.com/Redislabs-Solution-Architects/riot/releases/latest[latest RIOT distribution] (zip or tar.gz) and unpack the downloaded archive.

== Running
Use the `riot` script (`riot.bat` for Windows) to launch RIOT. 

== Usage
Follow the usage help provided with the `--help` option:
[source,shell]
----
riot --help
----

=== Databases

WARNING: Add the appropriate driver jar for your database under the `lib` directory

For example with MySQL: `lib/mysql-connector-java-5.1.47.jar`

=== JSON
RIOT can read and write JSON data in the following format:
[source,plaintext]
----
[
  {
    // JSON object
  },
  {
    // JSON object
  }
]
----

=== Generator

==== Simple
The simple data generator generates entries with a single field named `field` which is a sequence of integers.  

==== Faker
This data generator relies on the https://github.com/DiUS/java-faker[Faker] library.

== Examples

=== Import from databases
Let's import the following table from a MySQL database running locally: 
[source,plaintext]
----
mysql> describe employees;
+------------+---------------+------+-----+---------+-------+
| Field      | Type          | Null | Key | Default | Extra |
+------------+---------------+------+-----+---------+-------+
| emp_no     | int(11)       | NO   | PRI | NULL    |       |
| birth_date | date          | NO   |     | NULL    |       |
| first_name | varchar(14)   | NO   |     | NULL    |       |
| last_name  | varchar(16)   | NO   |     | NULL    |       |
| gender     | enum('M','F') | NO   |     | NULL    |       |
| hire_date  | date          | NO   |     | NULL    |       |
+------------+---------------+------+-----+---------+-------+
6 rows in set (0.01 sec)
----

[source,shell]
----
riot import db --url "jdbc:mysql://localhost:3306/employees?serverTimezone=PST&useLegacyDatetimeCode=false&useSSL=false" --username root --password --sql "select * from employees" hash --keyspace employee --keys emp_no
----

=== Import CSV files
Here is an excerpt of https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat[airports.dat] available at https://github.com/jpatokal/openflights[openflights]
----
1,"Goroka Airport","Goroka","Papua New Guinea","GKA","AYGA",-6.081689834590001,145.391998291,5282,10,"U","Pacific/Port_Moresby","airport","OurAirports"
2,"Madang Airport","Madang","Papua New Guinea","MAG","AYMD",-5.20707988739,145.789001465,20,10,"U","Pacific/Port_Moresby","airport","OurAirports"
3,"Mount Hagen Kagamuga Airport","Mount Hagen","Papua New Guinea","HGU","AYMH",-5.826789855957031,144.29600524902344,5388,10,"U","Pacific/Port_Moresby","airport","OurAirports"
----

.Import airports into a geoset
[source,shell]
----
riot import csv --url https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat --fields AirportID Name City Country IATA ICAO Latitude Longitude Altitude Timezone DST Tz Type Source geo --keyspace airportgeo --fields AirportID --longitude Longitude --latitude Latitude
----
.Query the `airportgeo` geoset using redis-cli
[source,plaintext]
----
> GEORADIUS airportgeo -122.4194 37.7749 20 mi
1) "3469"
2) "10360"
3) "8982"
…
----

=== Import JSON files
Here is an excerpt of beers.json available at https://github.com/rethinkdb/beerthink/blob/master/data/beers.json[beerthink]:
[source,json]
----
[
  {
    "id": "1",
    "brewery_id": "812",
    "name": "Hocus Pocus",
    "abv": "4.5",
    "…": "…",
    "style_name": "Light American Wheat Ale or Lager",
    "cat_name": "Other Style"
  },
  {
    "id": "6",
    "brewery_id": "1385",
    "name": "Winter Warmer",
    "abv": "5.199999809265137",
    "…": "…",
    "style_name": "Old Ale",
    "cat_name": "British Ale"
  },
  "…"
]
----

==== Import beers into Hashes
[source,shell]
----
riot import json --url https://raw.githubusercontent.com/rethinkdb/beerthink/master/data/beers.json hash --keyspace beer --keys id
----

[source,plaintext]
----
> HGETALL beer:1
 1) "last_mod"
 2) "2010-07-22 20:00:20 UTC"
 3) "style_name"
 4) "Light American Wheat Ale or Lager"
 5) "brewery_id"
 6) "812"
 …
----


==== Import beers to RediSearch
* Create an index with redis-cli
[source,plaintext]
----
FT.CREATE beerIdx SCHEMA abv NUMERIC SORTABLE id TAG name TEXT PHONETIC dm:en style_name TEXT cat_name TEXT brewery_id TAG
----
* Import data into the index
[source,shell]
----
riot import json --url https://raw.githubusercontent.com/rethinkdb/beerthink/master/data/beers.json search --index beerIdx --keys id
----
* Search beers
[source,plaintext]
----
> FT.SEARCH beerIdx "@abv:[7 9]"
 1) (integer) 500
 2) "5896"
 3)  1) cat_name
     2) "North American Ale"
     …
     7) style_name
     8) "American-Style Strong Pale Ale"
     …
    11) abv
    12) "7.099999904632568"
     …
----

=== Generate data

==== People
[source,shell]
----
riot import faker --max 100 --field id=sequence --field firstName=name.firstName --field lastName=name.lastName --field address=address.fullAddress hash --keyspace person --keys id
----

[source,plaintext]
----
> HGETALL person:1
1) "address"
2) "036 Robbin Points, North Sonia, PA 42251"
5) "firstName"
6) "Nickolas"
7) "lastName"
8) "Gleason"
---- 

==== Game of Thrones
[source,shell]
----
riot import faker --max 100 --field name=gameOfThrones.character set --keyspace got:characters --fields name
----

[source,plaintext]
----
> SMEMBERS got:characters
   1) "Nymella Toland"
   2) "Ysilla Royce"
   3) "Halmon Paege"
   4) "Mark Mullendore"
   5) "Cleyton Caswell"
   …
----

==== Faker Generators

https://github.com/DiUS/java-faker[Faker] generators:

* *address*: state timeZone lastName country latitude longitude firstName streetAddressNumber streetName zipCode streetAddress secondaryAddress stateAbbr streetSuffix streetPrefix citySuffix cityPrefix city cityName countryCode buildingNumber fullAddress
* *ancient*: primordial titan god hero
* *app*: name version author
* *artist*: name
* *avatar*: image
* *beer*: name yeast malt hop style
* *book*: title publisher author genre
* *bool*: bool
* *business*: creditCardNumber creditCardType creditCardExpiry
* *cat*: name registry breed
* *chuckNorris*: fact
* *code*: asin isbnGs1 isbnGroup isbnRegistrant isbn10 isbn13 imei ean8 gtin8 ean13 gtin13
* *color*: name hex
* *commerce*: productName material price promotionCode department color
* *company*: name suffix url industry profession buzzword catchPhrase logo domainName bs domainSuffix
* *country*: flag currencyCode currency countryCode2 countryCode3 capital
* *crypto*: sha1 sha256 md5 sha512
* *currency*: name code
* *date*: birthday
* *demographic*: educationalAttainment demonym race sex maritalStatus
* *dog*: name size memePhrase age sound coatLength gender breed
* *dragonBall*: character
* *educator*: secondarySchool course campus university
* *esports*: event player league game team
* *file*: fileName extension mimeType
* *finance*: creditCard bic iban randomCreditCardType createCountryCodeToBasicBankAccountNumberPatternMap
* *food*: spice ingredient measurement
* *friends*: location character quote
* *funnyName*: name
* *gameOfThrones*: character dragon house quote city
* *hacker*: abbreviation adjective noun verb ingverb
* *harryPotter*: location character quote book
* *hipster*: word
* *hitchhikersGuideToTheGalaxy*: location character specie marvinQuote starship quote planet
* *hobbit*: location character thorinsCompany quote
* *howIMetYourMother*: character catchPhrase highFive quote
* *idNumber*: valid ssnValid validSvSeSsn invalidSvSeSsn invalid
* *internet*: url uuid domainName password image avatar slug emailAddress safeEmailAddress domainWord domainSuffix macAddress ipV4Address privateIpV4Address publicIpV4Address ipV4Cidr ipV6Address ipV6Cidr userAgentAny
* *job*: field position title keySkills seniority
* *leagueOfLegends*: location summonerSpell masteries champion rank quote
* *lebowski*: character actor quote
* *lordOfTheRings*: location character
* *lorem*: character words word characters sentence paragraph
* *matz*: quote
* *medical*: medicineName symptoms diseaseName hospitalName
* *music*: key instrument chord genre
* *name*: name prefix suffix title lastName fullName firstName nameWithMiddle username
* *number*: digit randomDigit randomDigitNotZero randomNumber
* *overwatch*: location quote hero
* *phoneNumber*: phoneNumber cellPhone
* *pokemon*: name location
* *rickAndMorty*: location character quote
* *robin*: quote
* *rockBand*: name
* *shakespeare*: hamletQuote asYouLikeItQuote kingRichardIIIQuote romeoAndJulietQuote
* *slackEmoji*: people nature activity foodAndDrink celebration travelAndPlaces objectsAndSymbols custom emoji
* *space*: company planet moon galaxy nebula starCluster constellation star agency agencyAbbreviation meteorite nasaSpaceCraft distanceMeasurement
* *starTrek*: location character specie villain
* *stock*: nyseSymbol nsdqSymbol
* *superhero*: name prefix suffix descriptor power
* *team*: name state sport creature
* *twinPeaks*: location character quote
* *university*: name prefix suffix
* *weather*: temperatureCelsius temperatureFahrenheit description
* *witcher*: location character school monster quote witcher
* *yoda*: quote
* *zelda*: character game

=== Export to Databases

[source,shell]
----
riot export --keyspace beer --keys id db --url "jdbc:mysql://localhost:3306/employees?serverTimezone=PST&useLegacyDatetimeCode=false&useSSL=false" --username root --password --sql "INSERT INTO beers (id, name, style_name) VALUES (:id, :name, :style_name)"
----

=== Export to CSV
[source,shell]
----
riot export --keyspace beer --keys id csv --file export-beers.csv --names id name brewery_id abv --header
----

=== Export to JSON
[source,shell]
----
riot export --keyspace beer --keys id json --file export-beers.json
----

== Load Testing with Redis Enterprise

=== String
[source,shell]
----
riot --driver lettuce --host redis-12000.internal.jrx.demo.redislabs.com --port 12000 --max-total 96 import --chunk-size 500 --threads 96 simple --max 100000000 string --keyspace string --keys field1
----
image::riot-performance-strings.png[]

=== Stream
[source,shell]
----
riot --driver lettuce --host redis-12000.internal.jrx.demo.redislabs.com --port 12000 --max-total 96 import --chunk-size 500 --threads 96 simple --max 100000000 stream --keyspace stream --keys partition
----
image::riot-performance-streams.png[]